<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>templates/gallery/uploadform.html</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<style>
	.drop-zone{
		height: 100px;
		border: 3px solid #cecece;
		border-radius: 10px;
		display: flex;
		justify-content: center; /* 좌우로 가운데 정렬 */
		align-items: center; /* 위아래로 가운데 정렬 */
		cursor: pointer;
	}
</style>
</head>
<body>
	<div class="container">
		<h1 class="my-3">이미지 업로드 폼</h1>
		
		<form class="my-3" th:action="@{/gallery/upload}" method="post" enctype="multipart/form-data">
			<div class="my-3">
				<label for="image" class="form-label">파일</label>
				<input style="display: none" type="file" name="image" id="image" accept="image/*" class="form-control"/>
				<div class="drop-zone">Drag and Drop or click here</div>
			</div>
			
			<div class="my-3">
				<label for="caption" class="form-label">설명</label>
				<input type="text" name="caption" id="caption" class="form-control"/>
			</div>
			
			<button type="submit" class="btn btn-primary my-3">업로드</button>
		</form>
	</div>
	<script>
		const dropZone = document.querySelector(".drop-zone");
		dropZone.addEventListener("dragover", (e)=>{
			e.preventDefault();
		});
		dropZone.addEventListener("drop", (e)=>{
			e.preventDefault();
			
			const files = e.dataTransfer.files;
			if(files.length > 1){
				alert("하나의 파일만 드롭하세요")
				return;
			}
			
			const file = files[0];
			document.querySelector("#image").files = files;
			showImage(file);
		});
		
		dropZone.addEventListener("click", ()=>{
			document.querySelector("#image").click();
		});
		
		document.querySelector("#image").addEventListener("change", (e)=>{
			const files = e.target.files;
			const file = files[0];
			dropZone.innerText = file.name;
			showImage(file);
		});
		
		function showImage(file){
			const reader = new FileReader();
			reader.readAsDataURL(file);
			reader.onload = (e)=>{
				const data = e.target.result;
				dropZone.innerHTML = `<img style="margin: 10px" id="image" src="${data}">
									  <img style="margin: 10px" id="image" src="${data}">`;
				dropZone.style.height = "auto";
			}
		}
	</script>
</body>
</html>